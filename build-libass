#!/usr/bin/env zsh -e
#
# libass
# https://github.com/libass/libass.git
#

set -e

PS4='+ ${BASH_SOURCE}:${LINENO}: '

error_report() {
    echo "Error on line $1"
}

trap 'error_report $LINENO' ERR

cd "$(dirname "$0")"
set -a; source build.env; set +a
source utils/pkg-import

pkgname="libass"
pkgdir="$1"
srcdir="src/libass"

import_local_pkg $pkgdir

export CFLAGS="${CFLAGS} -O3 -flto=thin"

cd "${srcdir}"

./autogen.sh

./configure \
  --prefix="${pkgdir}" \
  --enable-shared \
  --disable-static \
  --disable-dependency-tracking \
  --enable-coretext \
  --enable-libunibreak \
  --enable-asm \
  --disable-fontconfig \
  # "$@"

make -j$(sysctl -n hw.physicalcpu)

# rm -rf "${pkgdir}"

make install

# vi:set ts=2 sw=2 et:
